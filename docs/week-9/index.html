<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Week 9: Unit Testing</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/devops_2022_2023_notes/assets/css/0.styles.8b92ebe3.css" as="style"><link rel="preload" href="/devops_2022_2023_notes/assets/js/app.6b44d852.js" as="script"><link rel="preload" href="/devops_2022_2023_notes/assets/js/2.df6d3794.js" as="script"><link rel="preload" href="/devops_2022_2023_notes/assets/js/15.8f97f017.js" as="script"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/10.4e5f8bbf.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/11.c02bdead.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/12.b84c2d85.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/13.6e280fb8.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/14.dbf62e29.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/16.18bdaae7.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/17.a1e08467.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/18.350a5a72.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/19.b63f02ee.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/20.0a41b244.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/21.18eb8a46.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/22.fe643793.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/23.4dc7ba8b.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/24.1f88b122.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/25.e21387a2.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/26.44356d14.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/27.f336bf53.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/28.6c253e60.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/29.d1b1705e.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/3.716870f2.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/30.f6b1bcb2.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/31.76e479c3.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/32.9fcb4892.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/33.67160554.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/34.6de6f42d.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/35.8ea2ce19.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/36.78afad19.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/37.8896c35d.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/38.93e10668.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/39.138b72c3.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/4.93c005d7.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/40.b9b6d5ed.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/5.85079047.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/6.8cbaff35.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/7.d6d14512.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/8.bfafa32f.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/9.98c65346.js">
    <link rel="stylesheet" href="/devops_2022_2023_notes/assets/css/0.styles.8b92ebe3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/devops_2022_2023_notes/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Module Overview</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops_2022_2023_notes/" aria-current="page" class="sidebar-link">Module Introduction (Start Here ‚ñ∂Ô∏è)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Assessments</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops_2022_2023_notes/assessment/" class="sidebar-link">Assessment Overview</a></li><li><a href="/devops_2022_2023_notes/assessment/scenario.html" class="sidebar-link">Assessment Scenario</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Side Tutorials</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 1: Introduction to DevOps</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 2: Static Code Analysis (1)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 3: Static Code Analysis (2)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 4: Component Driven Development</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 5: Testing</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 6: Database Testing</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 7: Authentication Testing Strategies and Deployment</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 8: CD Strategies</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Week 9: Unit Testing</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops_2022_2023_notes/week-9/" aria-current="page" class="active sidebar-link">Week 9: Unit Testing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-9/#lesson-dependencies-üî®" class="sidebar-link">Lesson Dependencies üî®</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-9/#task-0-get-the-starter-application" class="sidebar-link">TASK 0: Get the Starter Application</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-9/#task-1-unit-testing-discussion" class="sidebar-link">Task 1: Unit Testing Discussion</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-9/#what-is-a-unit" class="sidebar-link">What is a Unit</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-9/#react-testing-library" class="sidebar-link">React Testing Library</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-9/#task-2-installing-the-react-testing-library" class="sidebar-link">Task 2 : Installing the React Testing Library</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-9/#what-to-test" class="sidebar-link">What to test</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 10: Monitoring and Logging</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 11: Module Wrap Up (assessment support)</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="week-9-unit-testing"><a href="#week-9-unit-testing" class="header-anchor">#</a> Week 9: Unit Testing</h1> <p>This week we shall add some unit tests to our room tracking application. Specifically, we will answer the following questions:</p> <ol><li>What are the benefits of unit tests?</li> <li>What is a unit of code?</li> <li>How can I unit test React applications?</li></ol> <h2 id="lesson-dependencies-üî®"><a href="#lesson-dependencies-üî®" class="header-anchor">#</a> Lesson Dependencies üî®</h2> <ul><li><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" target="_blank" rel="noopener noreferrer">You will need to ensure you have the version control tool Git installed<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>You'll need to know the basic Git Commands (e.g., <code>checkout -b</code>, <code>push</code>, and <code>commit</code>)</li></ul></li> <li>While you can use any text editor for this session, I recommend that you install <a href="https://code.visualstudio.com/download" target="_blank" rel="noopener noreferrer">VS Code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>You will need access to a MongDB database.
<ul><li>You can install your own locally</li> <li>Use <a href="https://www.mongodb.com/atlas/database" target="_blank" rel="noopener noreferrer">AtlasDB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><a href="https://cloudinary.com/" target="_blank" rel="noopener noreferrer">You need a Cloudinary account<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.github.com" target="_blank" rel="noopener noreferrer">You need a GitHub account<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="task-0-get-the-starter-application"><a href="#task-0-get-the-starter-application" class="header-anchor">#</a> TASK 0: Get the Starter Application</h2> <p>If you have a working version of the room finder with authentications, you don't need to get a new version of the project. If not,</p> <p>In your command line shell, run:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">git</span> clone --branch week-9-starter-code  https://github.com/joeappleton18/solent-room-finder.git week-9
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><a href="/devops_2022_2023_notes/week-7/#task-0-1-get-the-starter-application">Next, follow the setup steps from week 7</a></p> <div class="custom-block tip"><p class="custom-block-title">DEFINITION</p> <p>üìñ <strong>Coverage</strong></p> <p>Test coverage is given details about the level to which the written coding of an application has been tested.</p></div> <p>I was in two minds about including unit tests in this course. After all, Cypress already offers us good test coverage. Moreover, we achieve this coverage with minimal effort. As such, Cypress could be your one and only, go to automation testing for your assessment. However, Cypress can't test the granular functionality of an application (e.g., does a spinner show when the application is in a loading state?).  Furthermore, many people (not me), swear by unit testings; particularly in the context of TDD.</p> <p>The benefits of unit testing are:</p> <ul><li>They are fast.</li> <li>They can guide the design of our applications.</li> <li>They act as documentation.</li> <li>They make you slow down and think about your application.</li> <li>They can be a fun way to increase understanding of the code base.</li> <li>It's easier, than integration testing, to test edge cases (e.g, what happens if we get a server error)</li></ul> <p>The cons of unit testing:</p> <ul><li>They can be complex to write.</li> <li>They can slow down the development process.</li> <li>We need more unit tests to achieve the same level of coverage as integration tests.</li> <li>As you'll find out today, they are tricky to retrospectively add.</li></ul> <h2 id="task-1-unit-testing-discussion"><a href="#task-1-unit-testing-discussion" class="header-anchor">#</a> Task 1: Unit Testing Discussion</h2> <p>In small groups consider:</p> <ol><li>Why we test?</li> <li>In what context does unit testing meet our testing needs?</li></ol> <h2 id="what-is-a-unit"><a href="#what-is-a-unit" class="header-anchor">#</a> What is a Unit</h2> <p>In order to derive a unit testing strategy, you must first answer the following questions:</p> <ol><li>What is a unit in the context of my application?</li> <li>Should this unit interact with other units of code?</li></ol> <p>In the context of our room tracking application, the answer to question one is simple. As we are using NextJS, a unit is simply a component.</p> <p>Question two is open to interpretation. Components rarely live in isolation; they interact with third-party libraries, databases, and components.   We have a few choices:</p> <ul><li>We can isolate our components for testing. This involves mocking (simulating) the functionality of external interactions. I am not a fan of this approach. It's time-consuming and mocks often don't perfectly resemble a third-party interaction.</li> <li>We can part mock interactions (e.g., IO and Auth). This ensures tests are both fast to run and write.</li></ul> <h2 id="react-testing-library"><a href="#react-testing-library" class="header-anchor">#</a> React Testing Library</h2> <p><a href="https://testing-library.com/docs/react-testing-library/intro/" target="_blank" rel="noopener noreferrer">We will use the popular, React Testing library for our unit tests.  According to, Kent Dod, its creator, &quot;the React Testing Library is a very light-weight solution for testing React components. It provides light utility functions on top of react-dom and react-dom/test-utils, in a way that encourages better testing practices. Its primary guiding principle is:<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote class="twitter-tweet"><p lang="en" dir="ltr">The more your tests resemble the way your software is used, the more confidence they can give you.</p>‚Äî Kent C. Dodds üåå (@kentcdodds) <a href="https://twitter.com/kentcdodds/status/977018512689455106?ref_src=twsrc%5Etfw">March 23, 2018</a></blockquote> <script async="async" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> <p>Let's see if we can add some unit tests to our application.</p> <h2 id="task-2-installing-the-react-testing-library"><a href="#task-2-installing-the-react-testing-library" class="header-anchor">#</a> Task 2 : Installing the React Testing Library</h2> <p>First we need to use NPM to install the react testing library. Run the following command in the root of your project:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> @testing-library/jest-dom @testing-library/react @testing-library/user-event jest jest-environment-jsdom @types/testing-library__jest-dom  eslint-plugin-testing-library
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><blockquote><p>Make sure you copy the full string!</p></blockquote></blockquote> <p>You may be thinking, that's a lot of dependencies, and you'd be right. Unlike Cypress, react testing library does not act like a robot interacting with our application. In contrast, it integrates with our code base. Above, we installed, react testing library and some types (for type script support). Further, we added Jest to run the tests. React Testing Library and <a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">Jest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> go hand in hand.</p> <p>, Next, we need configure our application. Create the following files in the route of your room finder project:<code>boostrapTests.js</code>, <code>jest.config.js</code>, <code>setupTests.ts</code> and <code>jest.setup.ts</code>. Add the following code to these newly created files (no need to fully understand this code):</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> nextJest <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;next/jest&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> createJestConfig <span class="token operator">=</span> <span class="token function">nextJest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// Provide the path to your Next.js app to load next.config.js and .env files in your test environment</span>
	<span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Add any custom config to be passed to Jest</span>
<span class="token keyword">const</span> customJestConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">setupFilesAfterEnv</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;rootDir&gt;/jest.setup.ts&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token literal-property property">testEnvironment</span><span class="token operator">:</span> <span class="token string">&quot;jest-environment-jsdom&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// createJestConfig is exported this way to ensure that next/jest can load the Next.js config which is async</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">createJestConfig</span><span class="token punctuation">(</span>customJestConfig<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><blockquote><p><code>jest.config.js</code></p></blockquote></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;@testing-library/jest-dom/extend-expect&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><blockquote><p><code>jest.setup.ts</code></p></blockquote></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;@testing-library/jest-dom&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><blockquote><p><code>setupTests.ts</code></p></blockquote></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;@testing-library/jest-dom&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><blockquote><p><code>bootstrapTests.ts</code></p></blockquote></blockquote> <p>Next, we need update <code>.eslintrc.json</code> to support linting for our tests:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
<span class="token operator">...</span>
<span class="token string-property property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token operator">...</span>
<span class="token string-property property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@typescript-eslint&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;testing-library&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">...</span>
 <span class="token string-property property">&quot;overrides&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// Only uses Testing Library lint rules in test files</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;**/__tests__/**/*.[jt]s?(x)&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;**/?(*.)+(spec|test).[jt]s?(x)&quot;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;plugin:testing-library/react&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><blockquote><p><code>.eslintrc.json</code>. <a href="https://github.com/joeappleton18/solent-room-finder/blob/week-9-solutions/.eslintrc.json" target="_blank" rel="noopener noreferrer">It may be easier to copy over this file with the contents of the week 9 solution<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></blockquote> <p>Next, we need to make the testing library's types available to our wider program. Within <code>tsconfig.json</code> extend your 'include' array to:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>...
&quot;include&quot;: [
    &quot;&quot;bootstrapTests.ts&quot;,
    &quot;next-env.d.ts&quot;,
    &quot;**/*.ts&quot;,
    &quot;**/*.tsx&quot;
  ]
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><blockquote><p>tsconfig.json</p></blockquote></blockquote> <p>Finally, we need to set up a script in our <code>package.json</code> file to run our tests:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
	...
	 <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	  ...
		<span class="token property">&quot;test:unit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest --watch&quot;</span>
		...
	 <span class="token punctuation">}</span>

	 ...
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><blockquote><p><code>package.json</code> : update the scripts section</p></blockquote></blockquote> <h2 id="what-to-test"><a href="#what-to-test" class="header-anchor">#</a> What to test</h2> <p>Phew, we are now ready to write some unit tests.</p> <p>We can start testing as low down on our applications component tree as we like. Let's first test our <code>src/components/Button.tsx</code>.  First, we need to create our test file.</p> <p>Tests should be called, <code>&lt;name&gt;</code>.test.tsx and we can place them anywhere in our application.  However, I like to place them in a <code>__tests__</code> folder.  Further, I like to place the test close to the components I am testing. With this in mind, let's create the following test file:</p> <p><code>src/components/__tests__/Button.test.tsx</code></p> <p>Add the following code to <code>Button.test.tsx</code>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>fireEvent<span class="token punctuation">,</span> render<span class="token punctuation">,</span> screen<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@testing-library/react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">&quot;../Button&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// we can organise tests into describe blocks</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;Button&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// this tests the component renders 	</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;renders&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button label<span class="token operator">=</span><span class="token string">&quot;Click Me&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;clicked&quot;</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// like Cypress we can grab elements and assert they are in teh document</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;displays a the label&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button label<span class="token operator">=</span><span class="token string">&quot;Click Me&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;clicked&quot;</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span><span class="token string">&quot;Click Me&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * I don't really like these sorts of tests.
   * You'll often see them, and they effectively
   * test the implementation of react.
   */</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;handles a click event&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button label<span class="token operator">=</span><span class="token string">&quot;Click Me&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;clicked&quot;</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span><span class="token string">&quot;Click Me&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * This is slightly better. We are now testing wider functions
 */</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;handles a click event&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> handleClickMock <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button label<span class="token operator">=</span><span class="token string">&quot;Click Me&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClickMock<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  fireEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">&quot;Click Me&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>handleClickMock<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><blockquote><blockquote><p><code>src/components/__tests__/Button.test.tsx</code></p></blockquote></blockquote> <p>You should now be able to run your test: <code>npm run test:unit</code></p> <p><img src="/devops_2022_2023_notes/assets/img/tests-passed.dcb1ae19.png" alt=""></p> <blockquote><blockquote><p>tests running</p></blockquote></blockquote> <p>If all has gone well, you should see the above prompt in your terminal. The greate thing about unit tests is we can run them continually in the background.</p> <p>Above, you can see we are operating similarly to Cypress. However, the fundamental difference is we can now test units of code in isolation. Furthermore, we can do what's known as mocking. Mocking is used in unit tests to replace the return value of a class method or function. Notice on line 33, we set up a mock function: <code>const handleClickMock = jest.fn();</code>. This mock is sometimes known as a spy as it tracks how many times it has been and how it's been called. We can then run assertions against this information: <code>expect(handleClickMock.mock.calls.length).toBe(1);</code>. In the case of this test, we assert that clicking the button invokes the callback method we have passed in.</p> <h1 id="task-2"><a href="#task-2" class="header-anchor">#</a> Task 2</h1> <p>Can you implement the <code>Button</code> test above. Further, can you write tests for the alert and bread crumb component.</p> <h1 id="task-3"><a href="#task-3" class="header-anchor">#</a> Task 3</h1> <h1 id="task-4"><a href="#task-4" class="header-anchor">#</a> Task 4</h1></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/devops_2022_2023_notes/week-8/" class="prev">
        Week 8: Closing the CI/CD Loop
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/devops_2022_2023_notes/assets/js/app.6b44d852.js" defer></script><script src="/devops_2022_2023_notes/assets/js/2.df6d3794.js" defer></script><script src="/devops_2022_2023_notes/assets/js/15.8f97f017.js" defer></script>
  </body>
</html>
