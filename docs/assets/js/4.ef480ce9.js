(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{284:function(t,e,s){t.exports=s.p+"assets/img/ci-pipeline_testing.9d56bbce.png"},285:function(t,e,s){t.exports=s.p+"assets/img/failing_spec.3ee93053.png"},286:function(t,e,s){t.exports=s.p+"assets/img/arrange,act,assert.5bc3e852.png"},287:function(t,e,s){t.exports=s.p+"assets/img/testing-environments.7992ec1b.png"},288:function(t,e,s){t.exports=s.p+"assets/img/test-runner-console.42e03224.png"},289:function(t,e,s){t.exports=s.p+"assets/img/e2e.5d41e2cd.png"},327:function(t,e,s){"use strict";s.r(e);var a=s(13),n=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"week-6-database-testing"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#week-6-database-testing"}},[t._v("#")]),t._v(" Week 6: Database Testing")]),t._v(" "),e("p",[e("img",{attrs:{src:s(284),alt:""}})]),t._v(" "),e("p",[t._v("This week, I want to continue to consider our testing strategy for our Solent room tracking application. However, as you'll find out, our room finder has been further developed;  we can now create, delete and update rooms and even filter them. In short, our application can manipulate data in a database.")]),t._v(" "),e("p",[t._v("While the hacker and developer in me appreciate the speed at which our room tracker is progressing, the pragmatic engineering side has concerns. The fact that our program manipulates a database presents a testing challenge. We need a way of allowing our tests to reliably and consistently interact with the database. This week, we will address this challenge by addressing the following questions:")]),t._v(" "),e("ol",[e("li",[t._v("How can I set up a test database?")]),t._v(" "),e("li",[t._v("How can I integrate tests into my CI/CD pipeline?")])]),t._v(" "),e("h2",{attrs:{id:"lesson-dependencies-🔨"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lesson-dependencies-🔨"}},[t._v("#")]),t._v(" Lesson Dependencies 🔨")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://git-scm.com/book/en/v2/Getting-Started-Installing-Git",target:"_blank",rel:"noopener noreferrer"}},[t._v("You will need to ensure you have the version control tool Git installed"),e("OutboundLink")],1),t._v(" "),e("ul",[e("li",[t._v("You'll need to know the basic Git Commands (e.g., "),e("code",[t._v("checkout -b")]),t._v(", "),e("code",[t._v("push")]),t._v(", and "),e("code",[t._v("commit")]),t._v(")")])])]),t._v(" "),e("li",[t._v("While you can use any text editor for this session, I recommend that you install "),e("a",{attrs:{href:"https://code.visualstudio.com/download",target:"_blank",rel:"noopener noreferrer"}},[t._v("VS Code"),e("OutboundLink")],1)]),t._v(" "),e("li",[t._v("You will need access to a MongDB database.\n"),e("ul",[e("li",[t._v("You can install your own locally")]),t._v(" "),e("li",[t._v("Use "),e("a",{attrs:{href:"https://www.mongodb.com/atlas/database",target:"_blank",rel:"noopener noreferrer"}},[t._v("AtlasDB"),e("OutboundLink")],1)])])])]),t._v(" "),e("h2",{attrs:{id:"task-0-get-the-starter-application"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#task-0-get-the-starter-application"}},[t._v("#")]),t._v(" TASK 0: Get the Starter Application")]),t._v(" "),e("p",[t._v("Since we now have a database, setup is a little more involved:")]),t._v(" "),e("p",[t._v("In your command line shell, run:")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone --branch week-6-starter-code  https://github.com/joeappleton18/solent-room-finder.git week-6\n\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("ul",[e("li",[t._v("Follow the instructions in the cloned project's "),e("code",[t._v("README.md")]),t._v(" to set up your development version of the Solent Room Finder.")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("Important Point")]),t._v(" "),e("p",[t._v("⭐️ "),e("strong",[t._v("Taking too long to install NPM dependencies at university")]),t._v("? "),e("a",{attrs:{href:"https://ssu-my.sharepoint.com/:f:/g/personal/joe_appleton_solent_ac_uk/Eoq4m_ZibL1KviE7247Y01oBxBssJkRCaVQYB5h5LHm1nw",target:"_blank",rel:"noopener noreferrer"}},[t._v("This is an odd issue, as the dependencies only take about 30-seconds to install on my, much slower, home network. To speed up the university installation you may just want to download the zip file of the project with all installed dependencies."),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"a-strategy-for-testing"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#a-strategy-for-testing"}},[t._v("#")]),t._v(" A strategy for testing")]),t._v(" "),e("p",[t._v("First, let's consider our testing strategy for this application. Since this is a non-business critical web application, I am assuming the following position:")]),t._v(" "),e("ul",[e("li",[t._v("Test after the features are developed (e.g., we are not practicing TDD). I find this helps us focus; we are not continually jumping between features and tests.")]),t._v(" "),e("li",[t._v("Take a user-first approach to testing.")]),t._v(" "),e("li",[t._v("Test outcomes, not implementation. For instance, test that an error box gets shown but not the message itself.")]),t._v(" "),e("li",[t._v("Start with wide-reaching integration tests (e.g., create, update, and delete a room).")]),t._v(" "),e("li",[t._v("You should note that this is just my stance on testing this kind of application.")]),t._v(" "),e("li",[t._v("Test on an environment that, as much as possible, mirrors production.")]),t._v(" "),e("li",[t._v("Avoid mocking functionality.")])]),t._v(" "),e("p",[t._v("Your testing strategy may differ, and as long as it is well justified, that's fine!")]),t._v(" "),e("h2",{attrs:{id:"task-1-considering-a-testing-strategy-for-the-assessment-scenario"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#task-1-considering-a-testing-strategy-for-the-assessment-scenario"}},[t._v("#")]),t._v(" TASK 1: Considering a Testing Strategy for the Assessment Scenario")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("TASK 1: Considering a Testing Strategy for the Assessment Scenario")]),t._v(" "),e("p",[e("RouterLink",{attrs:{to:"/assessment/scenario.html"}},[t._v("In groups, or individually, list out in bullet points the testing strategy that you aim to take for the assessment scenario.")])],1)]),t._v(" "),e("h2",{attrs:{id:"solent-he-have-a-problem"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#solent-he-have-a-problem"}},[t._v("#")]),t._v(" Solent, He Have a Problem!")]),t._v(" "),e("p",[e("img",{attrs:{src:s(285),alt:""}})]),t._v(" "),e("blockquote",[e("blockquote",[e("p",[t._v("Our tests are fragile.")])])]),t._v(" "),e("p",[t._v("We have a problem with our current test setup! Don't believe me:")]),t._v(" "),e("ul",[e("li",[t._v("delete a room, by clicking the rubbish bin by a room in the room table.")]),t._v(" "),e("li",[t._v("re-run your tests: "),e("code",[t._v("npm run cypress:run")])]),t._v(" "),e("li",[t._v("you  should now have two failed tests, ouch!")])]),t._v(" "),e("p",[t._v("The culprit is this assertion in "),e("code",[t._v("cypress/e2e/home.cy.ts")]),t._v(":")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("it")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"shows a table containing a list of rooms"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n \n "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n cy"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getByData")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"room-item"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("should")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"have.length"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\t\n\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br")])]),e("blockquote",[e("blockquote",[e("p",[e("code",[t._v("cypress/e2e/home.cy.ts")])])])]),t._v(" "),e("p",[t._v("Since we deleted a room, we now have 17 rooms in our table, not 18! We could re-seed the database; however, we don't necessarily want to re-set the database just to run the tests. In summary, we can't reliably run the tests against an unpredictable, changing database")]),t._v(" "),e("h2",{attrs:{id:"the-solution-arrange-act-assert"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#the-solution-arrange-act-assert"}},[t._v("#")]),t._v(" The Solution: ARRANGE-ACT-ASSERT")]),t._v(" "),e("p",[e("img",{attrs:{src:s(286),alt:""}})]),t._v(" "),e("blockquote",[e("blockquote",[e("p",[t._v("A pattern for testing")])])]),t._v(" "),e("p",[t._v("Above is a diagram of the common testing pattern arrange, act, assert.  Following this pattern, we must, before we act, arrange our application's state for testing. In our case, this means re-seeding the database. However, as we explored above, we don't want to re-seed our development database.")]),t._v(" "),e("p",[e("img",{attrs:{src:s(287),alt:""}})]),t._v(" "),e("blockquote",[e("blockquote",[e("p",[t._v("The different environments we will, eventually, set up. Each environment must be stand alone.")])])]),t._v(" "),e("p",[t._v("In order to implement our arrange, act, asset pattern, we need a dedicated test environment. In doing so, we can arrange this environment for acts and assertions.  Crucially, the test environment won't impact our development or production environments.")]),t._v(" "),e("p",[t._v("Luckily, Next.js comes allows us to easily manage multiple environments. You have already taken advantage of this functionality. Currently, your application uses the "),e("code",[t._v(".env.local")]),t._v(" file to see your enviroment. Next.js, however, allows us to use multiple environment files. "),e("a",{attrs:{href:"https://nextjs.org/docs/basic-features/environment-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("According to the documentation, Environment variables are looked up in the following places, in order, stopping once the variable is found"),e("OutboundLink")],1)]),t._v(" "),e("ol",[e("li",[t._v("process.env")]),t._v(" "),e("li",[t._v(".env.$(NODE_ENV).local")]),t._v(" "),e("li",[t._v(".env.local (Not checked when NODE_ENV is test.)")]),t._v(" "),e("li",[t._v(".env.$(NODE_ENV)")]),t._v(" "),e("li",[t._v(".env")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("DEFINITION")]),t._v(" "),e("p",[t._v("📖 "),e("strong",[t._v("NODE_ENV")])]),t._v(" "),e("p",[e("code",[t._v("NODE_ENV")]),t._v(" is an environment variable that was popularised by the express framework.")])]),t._v(" "),e("p",[t._v("According to the above, we just need to set "),e("code",[t._v("NODE_ENV")]),t._v(" ti testing, and this means "),e("code",[t._v(".env.testing")]),t._v(" will be used to populate out environment.")]),t._v(" "),e("h2",{attrs:{id:"task-2-setting-up-multiple-environments"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#task-2-setting-up-multiple-environments"}},[t._v("#")]),t._v(" Task 2: Setting up Multiple Environments")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("TASK 2: Setting up Multiple Environments")]),t._v(" "),e("ul",[e("li",[t._v("We need to change "),e("code",[t._v("process.env.NODE_ENV")]),t._v(" to "),e("code",[t._v("test")]),t._v(". To reliably do this across different operating systems we are going to install "),e("code",[t._v("cross-env")]),t._v(".\n"),e("ul",[e("li",[t._v("run: "),e("code",[t._v("npm install --save-dev cross-env")])])])]),t._v(" "),e("li",[t._v("Next, set up in  "),e("code",[t._v("package.json")]),t._v(" a script that runs our application in the test environment.")])]),t._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[t._v("\n... \n"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n... \n\n "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cross-env NODE_ENV=test  next dev"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n...\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br")])]),e("blockquote",[e("blockquote",[e("p",[e("code",[t._v("package.json")])])])]),t._v(" "),e("ul",[e("li",[t._v("Next, set up a "),e("code",[t._v(".env.test")]),t._v(" file in the root of your project, and add a URL to the test database. Since we are using MongDB you just need to change the name of the database from "),e("code",[t._v("rooms")]),t._v(" to something else (e,g., "),e("code",[t._v("room_test")]),t._v("). Here is what my connection string looks like:")])]),t._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[t._v("MONGODB_URI=<url>/rooms_test?retryWrites="),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("&w=majority\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("ul",[e("li",[e("p",[t._v("If your application is currently running in command line, stop it (CTRL/CMD C).")])]),t._v(" "),e("li",[e("p",[t._v("Run your application in test mode: "),e("code",[t._v("npm run test")])])]),t._v(" "),e("li",[e("p",[t._v("You should see after you run the command: "),e("code",[t._v("info - <path>.env.test")])])]),t._v(" "),e("li",[e("p",[t._v("You can now seed you database: visit "),e("code",[t._v("http://localhost:3001/api/utility")]),t._v(". You are seeding your test database, not your development database.")])])])]),t._v(" "),e("p",[t._v("Now we have a test environment. Let's consider how we might use it to arrange tests. Crucially, each test should be stand-alone and not be dependent on other tests.  After each test runs, the database should return to its original known state (18 records).")]),t._v(" "),e("p",[t._v("Let's consider how we might achieve this in Cypress.")]),t._v(" "),e("h2",{attrs:{id:"task-3-arranging-tests"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#task-3-arranging-tests"}},[t._v("#")]),t._v(" Task 3: Arranging Tests")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("Arranging Tests")]),t._v(" "),e("ul",[e("li",[t._v("Open your Cypress console:")]),t._v(" "),e("li",[e("code",[t._v("npm run cypress:open")])]),t._v(" "),e("li",[t._v("we can place commands in "),e("code",[t._v("cypress/support/e2e.ts")]),t._v(" that run before every test. Let's re-seed our database before each test. In "),e("code",[t._v("cypress/support/e2e.ts")]),t._v(" add:")])]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("beforeEach")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  cy"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"I run before every test in every spec file!!!!!!"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  cy"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:3000/api/utility/"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//resets database after every test")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])]),e("blockquote",[e("blockquote",[e("p",[e("code",[t._v("cypress/support/e2e.ts")])])])])]),t._v(" "),e("ul",[e("li",[t._v("Recall, the route "),e("code",[t._v("http://localhost:300/api/utility/")]),t._v(" seeds our database. You can see the code behind this by looking at "),e("code",[t._v("src/pages/api/utility/index.ts")])])]),t._v(" "),e("p",[e("img",{attrs:{src:s(288),alt:""}})]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Re-run your tests from the cypress console. If you click on one of the green ticks you should see "),e("code",[t._v("I run before every test in every spec file!!!!!!")])])]),t._v(" "),e("li",[e("p",[t._v("Cypress recommend you set a base url, now seems like a good time to do this. In "),e("code",[t._v("cypress.config.ts")]),t._v(" add a "),e("code",[t._v("baseURL")]),t._v(" property:")])])]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("defineConfig"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cypress"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineConfig")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("e2e")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("baseUrl")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:3000"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setupNodeEvents")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("on"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// implement node event listeners here")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br")])]),e("blockquote",[e("blockquote",[e("p",[e("code",[t._v("cypress.config.ts")])])])]),t._v(" "),e("ul",[e("li",[t._v("You can now remove "),e("code",[t._v("http:localhost:3000")]),t._v(" from your paths (e.g., "),e("code",[t._v("http:localhost:3000/create")]),t._v(" becomes "),e("code",[t._v("/create")]),t._v(" ). You'll need to update the paths in: "),e("code",[t._v("cypress/support/e2e.ts")]),t._v(", "),e("code",[t._v("cypress/e2e/create.cy.ts")]),t._v(", and "),e("code",[t._v("cypress/e2e/home.cy.ts")]),t._v(". For home and create this just involves updating the path in the forEach block.")]),t._v(" "),e("li",[t._v("Restart the cypress console for these updates to take effect.")])]),t._v(" "),e("h2",{attrs:{id:"task-3-arranging-tests-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#task-3-arranging-tests-2"}},[t._v("#")]),t._v(" Task 3: Arranging Tests")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("Adding some more tests")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Now that we have a test environment set up let's write some more tests. Create the following files:")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("cypress/e2e/delete.cy.ts")])])]),t._v(" "),e("li",[e("p",[e("code",[t._v("cypress/e2e/update.cy.ts")])])])]),t._v(" "),e("p",[t._v("Have a go at writing the following tests:")]),t._v(" "),e("p",[e("strong",[t._v("You will need to add "),e("code",[t._v("data-test=")]),t._v(" attributes to elements your need to test.")])]),t._v(" "),e("p",[e("strong",[t._v("cypress/e2e/create.cy.ts")])]),t._v(" "),e("ul",[e("li",[t._v("add the test "),e("code",[t._v('it("creates a new room", ()')])]),t._v(" "),e("li",[t._v("use the test above to work out how to fill out the form")]),t._v(" "),e("li",[t._v("After submission")]),t._v(" "),e("li",[t._v("Check the success alert exists. This is what my code looks like: "),e("code",[t._v('cy.getByData("success-alert").should("exist");')])]),t._v(" "),e("li",[t._v("Visit the home page: "),e("code",[t._v('cy.visit("/");')]),t._v(" and check there are 19 rooms in the table: "),e("code",[t._v('cy.getByData("room-item").should("have.length", 19);')])]),t._v(" "),e("li",[t._v("Check the room you created is in the table. Here is what my code looks like: "),e("code",[t._v('cy.getByData("room-item").contains(/RM1/);')])])]),t._v(" "),e("p",[e("strong",[t._v("cypress/e2e/delete.cy.ts")])]),t._v(" "),e("ul",[e("li",[t._v("add the test "),e("code",[t._v('it("deletes a room", () => {')])]),t._v(" "),e("li",[t._v("check that the table has 18 rooms: "),e("code",[t._v('cy.getByData("room-item").should("have.length", 18);')])]),t._v(" "),e("li",[e("code",[t._v('cy.getByData("delete-icon").eq(0).click();')])])]),t._v(" "),e("p",[e("strong",[t._v("cypress/e2e/create.cy.ts (if you fly through the above)")])]),t._v(" "),e("ul",[e("li",[t._v("work out how to test that update works")])]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/joeappleton18/solent-room-finder/tree/week-6-solutions",target:"_blank",rel:"noopener noreferrer"}},[t._v("If you did not get very far with the above: you can grab the completed test files from here"),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"running-cypress-in-continuous-integration-ci"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#running-cypress-in-continuous-integration-ci"}},[t._v("#")]),t._v(" Running Cypress in Continuous Integration (CI)")]),t._v(" "),e("p",[t._v("Would it not be great when we made a pull or pull request our tests ran as a GitHub workflow? Well! We can do just that. For the final task, let's consider how this might work.")]),t._v(" "),e("h2",{attrs:{id:"task-4-ci-integration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#task-4-ci-integration"}},[t._v("#")]),t._v(" Task 4: CI Integration")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("Task 4: CI Integration")]),t._v(" "),e("p",[t._v("Create "),e("code",[t._v(".github/workflows/cypress.yaml")]),t._v(" and add the following code:")]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" E2E on Chrome\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("push"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pull_request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("install")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Checkout\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v2\n\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Cypress run\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cypress"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("io/github"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@v3\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("browser")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" chrome\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm run build\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("start")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm run start\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wait-on")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:3000"')]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MONGODB_URI")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<add the url to your testing database>"')]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br")])]),e("blockquote",[e("blockquote",[e("p",[e("code",[t._v(".github/workflows/cypress.yaml")]),t._v(": ensure you update your  MONGODB_URI. If you want more security consider "),e("a",{attrs:{href:"https://docs.github.com/en/actions/security-guides/encrypted-secrets",target:"_blank",rel:"noopener noreferrer"}},[t._v("environment secrets"),e("OutboundLink")],1),t._v(". Above, we build our application and then use "),e("code",[t._v("cypress-io/github-action@v3")]),t._v(" to run the tests in the chrome, headless browser, pretty cool!")])])]),t._v(" "),e("ul",[e("li",[t._v("Next commit and deploy to a GitHub repo. You will need to set up your own repository, then go through the following process:")])]),t._v(" "),e("div",{staticClass:"language-command line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('git add -A \ngit commit -m "week 6 lesson completed"\ngit remote remove origin \ngit remote add origin <your repo url>\ngit push origin week-6-starter-code (you may need to append --force)\n')])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("p",[e("img",{attrs:{src:s(289),alt:""}})]),t._v(" "),e("ul",[e("li",[e("p",[t._v("If all has gone well you should she a green tick on your repository. When you click on it, you'll see that your tests ran 🎊 🎊 🎊 🎊 🎊 🎊 🎊🎊")])]),t._v(" "),e("li",[e("p",[t._v("Finally, it's always a nice touch to add badges to your "),e("code",[t._v("README.MD")]),t._v(" file. Git hub actions makes this easy, add the following to your "),e("code",[t._v("README.md")]),t._v(":")])])]),t._v(" "),e("p",[e("code",[t._v("![](<your repo's http address>/actions/workflows/cypress.yaml/badge.svg)")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);