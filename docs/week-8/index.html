<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Week 8: Closing the CI/CD Loop</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/devops_2022_2023_notes/assets/css/0.styles.8b92ebe3.css" as="style"><link rel="preload" href="/devops_2022_2023_notes/assets/js/app.a48a6b8c.js" as="script"><link rel="preload" href="/devops_2022_2023_notes/assets/js/2.28c99d85.js" as="script"><link rel="preload" href="/devops_2022_2023_notes/assets/js/9.a19509f1.js" as="script"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/10.a34ef9e8.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/11.4d1bbb71.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/12.90478fde.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/13.91aaf4e4.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/14.8f8b5a1e.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/15.0b37d921.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/16.bf9c367e.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/17.024aaa19.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/18.d8e1287d.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/19.d06ec004.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/20.b81634e2.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/21.83f5e990.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/22.72ebf527.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/23.c3de066c.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/24.f656f9f9.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/25.21681aec.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/26.e2689f3c.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/27.38e46057.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/28.9f78dec1.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/29.6c6b8d6d.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/3.216061c1.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/30.6899476d.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/31.50348eb3.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/32.0411bd28.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/33.4e6917da.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/34.0b99d5e3.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/35.aaa1aada.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/36.8254e916.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/37.996504bd.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/38.2e3fe52d.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/39.dcbabaf2.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/4.7049fa07.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/40.0c95ee98.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/41.ec30a8d0.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/42.f92b7444.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/5.0ff4981d.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/6.a616ffa3.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/7.0c3c45cf.js"><link rel="prefetch" href="/devops_2022_2023_notes/assets/js/8.bafdb726.js">
    <link rel="stylesheet" href="/devops_2022_2023_notes/assets/css/0.styles.8b92ebe3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/devops_2022_2023_notes/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Module Overview</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops_2022_2023_notes/" aria-current="page" class="sidebar-link">Module Introduction (Start Here ‚ñ∂Ô∏è)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Assessments</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops_2022_2023_notes/assessment/" class="sidebar-link">Assessment Overview</a></li><li><a href="/devops_2022_2023_notes/assessment/scenario.html" class="sidebar-link">Assessment Scenario</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Side Tutorials</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 1: Introduction to DevOps</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 2: Static Code Analysis (1)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 3: Static Code Analysis (ii)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 4: Component Driven Development</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 5: Testing</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 6: Database Testing</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 7: Authentication Testing Strategies and Deployment</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Week 8: CD Strategies</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops_2022_2023_notes/week-8/lecture.html" class="sidebar-link">Lecture</a></li><li><a href="/devops_2022_2023_notes/week-8/" aria-current="page" class="active sidebar-link">Week 8: Closing the CI/CD Loop</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-8/#week-8-closing-the-ci-cd-loop" class="sidebar-link">Week 8: Closing the CI/CD Loop</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-8/#lesson-dependencies-üî®" class="sidebar-link">Lesson Dependencies üî®</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-8/#task-0-getting-started" class="sidebar-link">Task 0: Getting Started</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-8/#feature-branching-is-controversial" class="sidebar-link">Feature branching is controversial</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-8/#task-1-discussing-the-pros-and-cons-of-branching" class="sidebar-link">Task 1: Discussing the Pros and Cons of Branching</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-8/#task-2-setting-up-gitflow" class="sidebar-link">Task 2: Setting up GitFlow</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-8/#_2-1-creating-a-staging-branch" class="sidebar-link">2.1: Creating a Staging Branch</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-8/#_2-3-staging-branches-auto-deploys" class="sidebar-link">2.3: Staging Branches Auto Deploys</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-8/#_2-4-first-feature-branch-flow" class="sidebar-link">2.4: First Feature Branch Flow</a></li><li class="sidebar-sub-header"><a href="/devops_2022_2023_notes/week-8/#_2-5-try-a-simplified-flow" class="sidebar-link">2.5 Try a simplified flow</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 9: Unit Testing</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Week 10: Monitoring and Logging</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops_2022_2023_notes/week-10/lecture.html" class="sidebar-link">Lecture</a></li><li><a href="/devops_2022_2023_notes/week-10/" class="sidebar-link">Week 10: Monitoring and Logging</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 11: Module Wrap Up (assessment support)</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="week-8-closing-the-ci-cd-loop"><a href="#week-8-closing-the-ci-cd-loop" class="header-anchor">#</a> Week 8: Closing the CI/CD Loop</h2> <p>This week, we are going to address the following question:</p> <ul><li>How can teams manage and deploy new software features using Git?</li></ul> <p>Unfortunately, the answer to the above question is &quot;it depends&quot;. To answer it, we will explore two  branching strategies: based on gitflow.</p> <h2 id="lesson-dependencies-üî®"><a href="#lesson-dependencies-üî®" class="header-anchor">#</a> Lesson Dependencies üî®</h2> <ul><li><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" target="_blank" rel="noopener noreferrer">You will need to ensure you have the version control tool Git installed<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>You'll need to know the basic Git Commands (e.g., <code>checkout -b</code>, <code>push</code>, and <code>commit</code>)</li></ul></li> <li>While you can use any text editor for this session, I recommend that you install <a href="https://code.visualstudio.com/download" target="_blank" rel="noopener noreferrer">VS Code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>You will need access to a MongDB database.
<ul><li>You can install your own locally</li> <li>Use <a href="https://www.mongodb.com/atlas/database" target="_blank" rel="noopener noreferrer">AtlasDB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><a href="https://cloudinary.com/" target="_blank" rel="noopener noreferrer">You need a Cloudinary account<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.github.com" target="_blank" rel="noopener noreferrer">You need a GitHub account<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="/devops_2022_2023_notes/week-7/#task-2-deploying-our-application">You will need to have signed up to https://vercel.com/ and deployed a version of the solent room finder</a></li></ul> <h2 id="task-0-getting-started"><a href="#task-0-getting-started" class="header-anchor">#</a> Task 0: Getting Started</h2> <div class="custom-block warning"><p class="custom-block-title">TASK</p> <p>This week, we are going to work in small groups to set up a CI/CD solution. For this task:</p> <ol><li>Form a group</li> <li><a href="/devops_2022_2023_notes/week-7/#task-2-deploying-our-application">Ensure that one of your team members has a deployed version of the Room Finder application. If not, complete the final task from last week.</a></li> <li>The group member that has deployed a version of the project should add their team members as contributors to the GitHub project of the deployed application.</li> <li>All team members should clone the repo and set up a development version of the Room Finder application</li></ol></div> <h2 id="feature-branching-is-controversial"><a href="#feature-branching-is-controversial" class="header-anchor">#</a> Feature branching is controversial</h2> <div class="custom-block tip"><p class="custom-block-title">DEFINITION</p> <p>üìñ <strong>Feature Branch</strong></p> <p><a href="https://www.atlassian.com/git/tutorials/comparing-workflows/feature-branch-workflow" target="_blank" rel="noopener noreferrer">The core idea behind the Feature Branch Workflow is that all feature development should take place in a dedicated branch instead of the main branch. This encapsulation makes it easy for multiple developers to work on a particular feature without disturbing the main codebase. It also means the main branch will never contain broken code, which is a huge advantage for continuous integration environments.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <p><img src="/devops_2022_2023_notes/assets/img/git-flow.f3ecc3cf.png" alt=""></p> <blockquote><blockquote><p>An example of the git flow branching strategy (<a href="https://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>). As you can see, it's some what complex.</p></blockquote></blockquote> <p><a href="https://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="noopener noreferrer">Feature branching, unfortunately has a bad reputation. This is mostly due to, historically, teams using a technique called GitFlow, popularised by Vincent Driessen<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.  However, in recent times, this technique has come under some criticism. The root of these critiques is its complexity and the worry of old, unmerged feature branches. Old branches are particularly troublesome as they are prone to merge into conflict hell! This has led to Vincent Driessen suggesting that teams should &quot;adopt a much simpler workflow (like GitHub flow) instead of trying to shoehorn git-flow into your team&quot;.</p> <p><a href="https://docs.github.com/en/get-started/quickstart/github-flow" target="_blank" rel="noopener noreferrer">According to GitHub, &quot;GitHub flow is a lightweight, branch-based workflow.  GitHub flow is useful for everyone, not just developers&quot;. Therefore, it seems like a good choice for our Room Finder application.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="task-1-discussing-the-pros-and-cons-of-branching"><a href="#task-1-discussing-the-pros-and-cons-of-branching" class="header-anchor">#</a> Task 1: Discussing the Pros and Cons of Branching</h2> <div class="custom-block warning"><p class="custom-block-title">Task 1: Discussing the Pros and Cons of Branching</p> <p>Before we start the practical portion of this week's session. In your groups,  research and discuss different Git team branching strategies.</p></div> <h2 id="task-2-setting-up-gitflow"><a href="#task-2-setting-up-gitflow" class="header-anchor">#</a> Task 2: Setting up GitFlow</h2> <p>For this task, we are going to work our small groups to set up two different team workflows: a feature branch workflow, and a simplified direct push to the staging branch.  Using Vercel, we can automatically deploy a staging version of of project each time we commit to the staging branch.</p> <h2 id="_2-1-creating-a-staging-branch"><a href="#_2-1-creating-a-staging-branch" class="header-anchor">#</a> 2.1: Creating a Staging Branch</h2> <p>For both of these strategies, you are going to need a staging branch. One team member should:</p> <ul><li>Locally, check out a new staging branch: git checkout -b staging</li> <li>Push this branch upstream: git push origin staging</li> <li><a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/defining-the-mergeability-of-pull-requests/about-protected-branches" target="_blank" rel="noopener noreferrer">Work out how to protect the staging and main branch so no one can push to these branches.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="_2-3-staging-branches-auto-deploys"><a href="#_2-3-staging-branches-auto-deploys" class="header-anchor">#</a> 2.3: Staging Branches Auto Deploys</h2> <p>If you check your https://vercel.com/ project dash, you should see that Vercel attempted to deploy your staging branch. However, this deployment probably failed. In fact, for every branch, you create Vercel will create a custom deployment for you!</p> <p>Currently, our application deploys on a random URL. This is a problem in staging, as we need to test authentication. For OAuth to work, we need a stable redirect URL.  This is a very easy challenge to solve:</p> <p><img src="/devops_2022_2023_notes/assets/img/staging.e4507fed.png" alt=""></p> <blockquote><blockquote><p>My staging branch</p></blockquote></blockquote> <ol><li>To create a staging environment, you'll first need to add a custom domain to your project. In Vercel, You can add a domain by clicking the &quot;Settings&quot; tab from a Project and selecting the Domains section. From the Domains section, you can assign a domain to the appropriate Git branch. The domain will need to be <code>&lt;staging-name&gt;</code>.vercel.app: mine is <a href="solent-room-finder-staging.vercel.app">solent-room-finder-staging.vercel.app</a>.</li></ol> <iframe src="https://app.tango.us/app/embed/aa7f903b-5671-4505-ba79-3efe9551eca5?iframe" sandbox="allow-scripts allow-top-navigation-by-user-activation allow-popups allow-same-origin" security="restricted" title="Tango Workflow" width="100%" height="600px" referrerpolicy="strict-origin-when-cross-origin" frameborder="0" webkitallowfullscreen="webkitallowfullscreen" mozallowfullscreen="mozallowfullscreen" allowfullscreen="allowfullscreen"></iframe> <ol start="2"><li><p>Now you have a stable domain, you can set up a new Github OAuth application.</p></li> <li><p>You can now begin to set up the staging environment:</p> <ol><li>In your Vercel project setting, set the following environment vars for your staging branch):
<ol><li>NEXTAUTH_URL=your staging URL</li> <li>NEXT_PUBLIC_TESTING= have no value in it</li> <li>MONGODB_URI= a staging database url (use AtlasDB)</li> <li>GITHUB_SECRET= a generated secret from your OAuth application</li> <li>GITHUB_ID= your OAuth Applications ID</li></ol></li></ol></li></ol> <p>Finally, we want any further preview branch to not have auth. To achieve this add a <code>NEXT_PUBLIC_TESTING = true</code>  environment variable for your preview environment. Since we have set this environment variable = &quot;&quot; (no value) in staging already, this won't impact our staging environment. In the same vein: set a <code>MONGODB_URI</code> environment variable up for preview branches.</p> <h2 id="_2-4-first-feature-branch-flow"><a href="#_2-4-first-feature-branch-flow" class="header-anchor">#</a> 2.4: First Feature Branch Flow</h2> <p>One or more team members should check out (locally) a new feature branch: <code>git checkout -b</code>myGreateFeature`.</p> <ul><li><p>Make some token changes to the application and a few commits.</p></li> <li><p>Push this branch to the origin: <code>git push origin</code>myGreateFeature`.</p></li></ul> <p><img src="/devops_2022_2023_notes/assets/img/deployment.af4f7c70.png" alt=""></p> <blockquote><blockquote><p>this is what your pull request should look like</p></blockquote></blockquote> <ul><li><p>Figure out how to raise a pull request into the staging branch. If all has gone well, you should see your GitHub workflows running.  You'll also get a sample deployment of your application.</p></li> <li><p>If all the tests pass and the preview deployment looks good, then merge and close the pull request.</p></li> <li><p>Your application should now be in staging. To deploy to production, you need to raise a further pull request from staging into master.</p></li></ul> <h2 id="_2-5-try-a-simplified-flow"><a href="#_2-5-try-a-simplified-flow" class="header-anchor">#</a> 2.5 Try a simplified flow</h2> <p>I don't mind the above flow; it provides a stable branch you can share with the product owner. However, you may want to simplify it more. As a final task, set up a workflow where all team members push directly to staging. When the release is ready, raise a pull request directly into the main branch.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/devops_2022_2023_notes/week-8/lecture.html" class="prev">
        Lecture
      </a></span> <span class="next"><a href="/devops_2022_2023_notes/week-9/">
        Week 9: Unit Testing
      </a>
      ‚Üí
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/devops_2022_2023_notes/assets/js/app.a48a6b8c.js" defer></script><script src="/devops_2022_2023_notes/assets/js/2.28c99d85.js" defer></script><script src="/devops_2022_2023_notes/assets/js/9.a19509f1.js" defer></script>
  </body>
</html>
